<div class="main-content">
  <div class="header-section">
    <div class="header-left">
      <h2>ğŸ“Š Reporte de Ingresos</h2>
      <p class="subtitle">AnÃ¡lisis de facturaciÃ³n por perÃ­odo</p>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filter-card">
    <form [formGroup]="filterForm" (ngSubmit)="loadIngresos()">
      <div class="filter-grid">
        <div class="form-group">
          <label for="fechaInicio">
            <span class="label-icon">ğŸ“…</span>
            Fecha Inicio
          </label>
          <input
            type="date"
            id="fechaInicio"
            formControlName="fechaInicio"
            class="form-input"
          >
        </div>

        <div class="form-group">
          <label for="fechaFin">
            <span class="label-icon">ğŸ“…</span>
            Fecha Fin
          </label>
          <input
            type="date"
            id="fechaFin"
            formControlName="fechaFin"
            class="form-input"
          >
        </div>

        <div class="form-group">
          <label for="idSucursal">
            <span class="label-icon">ğŸ¢</span>
            Sucursal
          </label>
          <select id="idSucursal" formControlName="idSucursal" class="form-select">
            <option value="1">Sucursal Principal</option>
          </select>
        </div>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="filterForm.invalid || isLoading"
        >
          @if (isLoading) {
            <span class="btn-spinner"></span>
            Cargando...
          } @else {
            ğŸ” Buscar
          }
        </button>
      </div>
    </form>
  </div>

<div class="main-content">
  <div class="header-section">
    <div class="header-left">
      <h2>ğŸ“Š Reporte de Ingresos</h2>
      <p class="subtitle">AnÃ¡lisis de facturaciÃ³n por perÃ­odo</p>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filter-card">
    <form [formGroup]="filterForm" (ngSubmit)="loadIngresos()">
      <div class="filter-grid">
        <div class="form-group">
          <label for="fechaInicio">
            <span class="label-icon">ğŸ“…</span>
            Fecha Inicio
          </label>
          <input
            type="date"
            id="fechaInicio"
            formControlName="fechaInicio"
            class="form-input"
          >
        </div>

        <div class="form-group">
          <label for="fechaFin">
            <span class="label-icon">ğŸ“…</span>
            Fecha Fin
          </label>
          <input
            type="date"
            id="fechaFin"
            formControlName="fechaFin"
            class="form-input"
          >
        </div>

        <div class="form-group">
          <label for="idSucursal">
            <span class="label-icon">ğŸ¢</span>
            Sucursal
          </label>
          <select id="idSucursal" formControlName="idSucursal" class="form-select">
            <option value="1">Sucursal Principal</option>
          </select>
        </div>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="filterForm.invalid || isLoading"
        >
          @if (isLoading) {
            <span class="btn-spinner"></span>
            Cargando...
          } @else {
            ğŸ” Buscar
          }
        </button>
      </div>
    </form>
  </div>

  <!-- Cards de Resumen -->
  @if (!isLoading && ingresos.length > 0) {
    <div class="summary-cards">
      <div class="summary-card card-facturado">
        <div class="card-icon">ğŸ’°</div>
        <div class="card-content">
          <span class="card-label">Ingresos Totales</span>
          <span class="card-value">S/ {{ getTotalFacturado() | number:'1.2-2' }}</span>
          <span class="card-detail">{{ getTotalFacturas() }} facturas</span>
        </div>
      </div>

      <div class="summary-card card-pagado">
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-content">
          <span class="card-label">Promedio por Factura</span>
          <span class="card-value">S/ {{ getPromedioGeneral() | number:'1.2-2' }}</span>
          <span class="card-detail">Por transacciÃ³n</span>
        </div>
      </div>

      <div class="summary-card card-pendiente">
        <div class="card-icon">ğŸ“…</div>
        <div class="card-content">
          <span class="card-label">DÃ­as con Ventas</span>
          <span class="card-value">{{ ingresos.length }}</span>
          <span class="card-detail">En el perÃ­odo</span>
        </div>
      </div>
    </div>
  }

  <!-- Tabla de Detalles -->
  <div class="data-card">
    @if (isLoading) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Cargando datos...</p>
      </div>
    } @else if (ingresos.length > 0) {
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>ğŸ“… Fecha</th>
              <th># Facturas</th>
              <th>ğŸ’° Ingresos Totales</th>
              <th>ğŸ“Š Promedio/Factura</th>
            </tr>
          </thead>
          <tbody>
            @for (ingreso of ingresos; track ingreso.fecha) {
              <tr>
                <td>
                  <span class="date-badge">
                    {{ ingreso.fecha | date:'dd/MM/yyyy' }}
                  </span>
                </td>
                <td>
                  <span class="count-badge">{{ ingreso.cantidad_facturas }}</span>
                </td>
                <td class="amount-cell">
                  <span class="amount amount-facturado">
                    S/ {{ ingreso.ingresos_totales | number:'1.2-2' }}
                  </span>
                </td>
                <td class="amount-cell">
                  <span class="amount amount-promedio">
                    S/ {{ ingreso.promedio_por_factura | number:'1.2-2' }}
                  </span>
                </td>
              </tr>
            }
          </tbody>
          <tfoot>
            <tr>
              <td><strong>TOTALES</strong></td>
              <td><strong>{{ getTotalFacturas() }}</strong></td>
              <td class="amount-cell">
                <strong class="amount amount-facturado">
                  S/ {{ getTotalFacturado() | number:'1.2-2' }}
                </strong>
              </td>
              <td class="amount-cell">
                <strong class="amount amount-promedio">
                  S/ {{ getPromedioGeneral() | number:'1.2-2' }}
                </strong>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    } @else {
      <div class="empty-state">
        <div class="empty-icon">ğŸ“Š</div>
        <h3>No hay datos disponibles</h3>
        <p>No se encontraron ingresos para el perÃ­odo seleccionado</p>
        <p class="empty-hint">Intenta ajustar las fechas o seleccionar otra sucursal</p>
      </div>
    }
  </div>
</div>
