<div class="main-content">
  <div class="header-actions">
    <div>
      <h2>ğŸ“… Listado de Citas</h2>
      <p class="subtitle">Gestiona las citas programadas</p>
    </div>
    <a routerLink="/appointments/new" class="btn btn-primary">
      â• Nueva Cita
    </a>
  </div>

  <div class="card">
    <!-- Search Bar -->
    <div class="search-section">
      <div class="search-box">
        <span class="search-icon">ğŸ”</span>
        <input
          type="text"
          placeholder="Buscar por cliente, mascota o servicio..."
          [(ngModel)]="searchTerm"
          (input)="filterCitas()"
          class="search-input"
        >
      </div>
      <div class="results-count">
        <span class="count-badge">{{ filteredCitas.length }}</span>
        {{ filteredCitas.length === 1 ? 'cita encontrada' : 'citas encontradas' }}
      </div>
    </div>

    <!-- Appointments Table -->
    <div class="table-container">
      <table class="citas-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Fecha & Hora</th>
            <th>Cliente & Mascota</th>
            <th>Servicio</th>
            <th>Modalidad</th>
            <th>Estado</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (cita of filteredCitas; track cita.idCita) {
            <tr class="cita-row">
              <td>
                <div class="cita-id">{{ cita.idCita }}</div>
              </td>
              <td>
                <div class="date-info">
                  <span class="date-main">ğŸ“… {{ cita.fechaProgramada | date:'dd/MM/yyyy' }}</span>
                  <span class="time-main">ğŸ•’ {{ cita.fechaProgramada | date:'h:mm a' }}</span>
                </div>
              </td>
              <td>
                <div class="client-pet-info">
                  <div class="info-row">
                    <span class="info-icon">ğŸ‘¤</span>
                    <span class="info-text">{{ cita.nombreCliente || 'Cliente #' + cita.idCliente }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-icon">ğŸ¾</span>
                    <span class="info-text pet-name">{{ cita.nombreMascota || 'Mascota #' + cita.idMascota }}</span>
                  </div>
                </div>
              </td>
              <td>
                <div class="service-badge">
                  âœ‚ï¸ {{ cita.nombreServicio || 'Servicio #' + cita.idServicio }}
                </div>
              </td>
              <td>
                <span [class]="'modality-badge modality-' + cita.modalidad">
                  @if (cita.modalidad === 'presencial') {
                    ğŸ  Presencial
                  } @else {
                    ğŸ’» Virtual
                  }
                </span>
              </td>
              <td>
                <span [class]="'status-badge status-' + cita.estado">
                  {{ getStatusLabel(cita.estado!) }}
                </span>
              </td>
              <!-- Acciones segÃºn estado -->
              <td class="text-center">
                <div class="action-buttons">
                  @if (cita.estado === 'reservada') {
                    <button class="btn-action btn-confirm" (click)="confirmCita(cita.idCita!)" title="Confirmar cita">
                      âœ“
                    </button>
                  }
                  @if (cita.estado === 'confirmada') {
                    <button class="btn-action btn-attend" (click)="crearAtencion(cita.idCita!)" title="Crear atenciÃ³n">
                      â•
                    </button>
                  }
                  @if (cita.estado === 'reservada' || cita.estado === 'confirmada') {
                    <button class="btn-action btn-reschedule" (click)="rescheduleCita(cita.idCita!)" title="Reprogramar">
                      ğŸ”„
                    </button>
                    <button class="btn-action btn-cancel" (click)="cancelCita(cita.idCita!)" title="Cancelar">
                      âœ•
                    </button>
                  }
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="7" class="empty-state">
                <div class="empty-content">
                  <div class="empty-icon">ğŸ“…</div>
                  <p>No hay citas programadas</p>
                  <a routerLink="/appointments/new" class="btn btn-primary-small">Agendar primera cita</a>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination Info -->
    @if (filteredCitas.length > 0) {
      <div class="table-footer">
        <span class="footer-text">
          Mostrando {{ filteredCitas.length }} de {{ citas.length }} citas
        </span>
      </div>
    }
  </div>
</div>

<!-- Reschedule Modal -->
@if (showRescheduleModal && selectedCita) {
  <div class="modal-overlay" (click)="closeRescheduleModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ”„ Reprogramar Cita</h3>
        <button class="modal-close" (click)="closeRescheduleModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <!-- Current Appointment Info -->
        <div class="current-info">
          <h4>Cita Actual</h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">ğŸ‘¤ Cliente:</span>
              <span class="info-value">{{ selectedCita.nombreCliente }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">ğŸ¾ Mascota:</span>
              <span class="info-value">{{ selectedCita.nombreMascota }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">âœ‚ï¸ Servicio:</span>
              <span class="info-value">{{ selectedCita.nombreServicio }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">ğŸ“… Fecha Actual:</span>
              <span class="info-value">{{ selectedCita.fechaProgramada | date:'dd/MM/yyyy h:mm a' }}</span>
            </div>
          </div>
        </div>

        <!-- New Date/Time Form -->
        <div class="new-schedule">
          <h4>Nueva Fecha y Hora</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="newDate">
                <span class="label-icon">ğŸ“…</span>
                Fecha
              </label>
              <input
                type="date"
                id="newDate"
                [(ngModel)]="newDate"
                class="form-input"
                required
              >
            </div>
            <div class="form-group">
              <label for="newTime">
                <span class="label-icon">ğŸ•’</span>
                Hora
              </label>
              <input
                type="time"
                id="newTime"
                [(ngModel)]="newTime"
                class="form-input"
                required
              >
            </div>
          </div>
        </div>

        <!-- Preview -->
        @if (newDate && newTime) {
          <div class="preview-section">
            <div class="preview-icon">âœ¨</div>
            <div class="preview-text">
              <span class="preview-label">Nueva cita programada para:</span>
              <span class="preview-date">{{ newDate | date:'dd/MM/yyyy' }} a las {{ newTime }}</span>
            </div>
          </div>
        }
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeRescheduleModal()">
          Cancelar
        </button>
        <button class="btn-primary-action" (click)="saveReschedule()">
          ğŸ’¾ Guardar Nueva Fecha
        </button>
      </div>
    </div>
  </div>
}
