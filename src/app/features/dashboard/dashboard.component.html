<div class="dashboard-container">
  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-overlay">
      <div class="spinner"></div>
      <p>Cargando dashboard...</p>
    </div>
  }

  <!-- Main Metrics Cards -->
  <div class="metrics-grid">
    <div class="metric-card metric-primary">
      <div class="metric-icon">ğŸ‘¥</div>
      <div class="metric-content">
        <h3>Total Clientes</h3>
        <p class="metric-value">{{ totalClientes }}</p>
      </div>
    </div>

    <div class="metric-card metric-success">
      <div class="metric-icon">ğŸ“…</div>
      <div class="metric-content">
        <h3>Citas Hoy</h3>
        <p class="metric-value">{{ citasHoy }}</p>
      </div>
    </div>

    <div class="metric-card metric-warning">
      <div class="metric-icon">ğŸ’°</div>
      <div class="metric-content">
        <h3>Ingresos del DÃ­a</h3>
        <p class="metric-value">S/ {{ ingresosDia | number:'1.2-2' }}</p>
      </div>
    </div>

    <div class="metric-card metric-info">
      <div class="metric-icon">â±ï¸</div>
      <div class="metric-content">
        <h3>Atenciones en Curso</h3>
        <p class="metric-value">{{ atencionesEnCurso }}</p>
      </div>
    </div>
  </div>

  <!-- Queue and Statistics Row -->
  <div class="dashboard-row">
    <!-- Queue Table -->
    <div class="dashboard-card cola-card">
      <div class="card-header">
        <h2>ğŸ“‹ Cola de AtenciÃ³n</h2>
        <span class="badge">En vivo</span>
      </div>
      <div class="card-body">
        @if (colaData.length > 0) {
          <div class="queue-table-container">
            <table class="queue-table">
              <thead>
                <tr>
                  <th>Turno</th>
                  <th>Mascota</th>
                  <th>Cliente</th>
                  <th>Groomer</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                @for (item of colaData; track item.id_atencion) {
                  <tr>
                    <td class="turno-cell">#{{ item.turno_num }}</td>
                    <td class="mascota-cell">ğŸ¾ {{ item.mascota }}</td>
                    <td>{{ item.cliente }}</td>
                    <td>{{ item.groomer || 'â³ Sin asignar' }}</td>
                    <td>
                      <span [class]="'status-badge ' + getEstadoBadgeClass(item.estado)">
                        {{ item.estado }}
                      </span>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <div class="empty-state">
            <p>âœ… No hay atenciones en cola</p>
          </div>
        }
      </div>
    </div>

    <!-- Monthly Statistics Chart -->
    <div class="dashboard-card stats-card">
      <div class="card-header">
        <h2>ğŸ“Š EstadÃ­sticas del Mes</h2>
      </div>
      <div class="card-body">
        @if (estadisticasData) {
          <div class="stats-chart">
            <div class="stat-bar-item">
              <div class="stat-label">
                <span class="stat-icon">ğŸ’µ</span>
                <span>Total Facturado</span>
              </div>
              <div class="stat-bar-container">
                <div class="stat-bar"
                     [style.width.%]="getBarPercentage(estadisticasData.total_facturado)"
                     style="background: linear-gradient(90deg, #27ae60, #2ecc71);">
                </div>
              </div>
              <span class="stat-value">S/ {{ estadisticasData.total_facturado | number:'1.2-2' }}</span>
            </div>

            <div class="stat-bar-item">
              <div class="stat-label">
                <span class="stat-icon">ğŸ‘¤</span>
                <span>Clientes Nuevos</span>
              </div>
              <div class="stat-bar-container">
                <div class="stat-bar"
                     [style.width.%]="getBarPercentage(estadisticasData.clientes_nuevos)"
                     style="background: linear-gradient(90deg, #3498db, #5dade2);">
                </div>
              </div>
              <span class="stat-value">{{ estadisticasData.clientes_nuevos }}</span>
            </div>

            <div class="stat-bar-item">
              <div class="stat-label">
                <span class="stat-icon">âœ‚ï¸</span>
                <span>Atenciones</span>
              </div>
              <div class="stat-bar-container">
                <div class="stat-bar"
                     [style.width.%]="getBarPercentage(estadisticasData.atenciones_realizadas)"
                     style="background: linear-gradient(90deg, #9b59b6, #bb8fce);">
                </div>
              </div>
              <span class="stat-value">{{ estadisticasData.atenciones_realizadas }}</span>
            </div>

            <div class="stat-bar-item">
              <div class="stat-label">
                <span class="stat-icon">â­</span>
                <span>Servicio Popular</span>
              </div>
              <span class="stat-value popular-service">{{ estadisticasData.servicio_popular || 'N/A' }}</span>
            </div>
          </div>
        } @else {
          <div class="empty-state">
            <p>ğŸ“Š No hay estadÃ­sticas disponibles</p>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Income Trend Chart -->
  <div class="dashboard-card income-card">
    <div class="card-header">
      <h2>ğŸ’¸ Tendencia de Ingresos</h2>
      <span class="subtitle">Del mes actual</span>
    </div>
    <div class="card-body">
      @if (ingresosData.length > 0) {
        <div class="chart-container">
          <canvas baseChart
                  [data]="incomeChartData"
                  [options]="incomeChartOptions"
                  [type]="'line'">
          </canvas>
        </div>
      } @else {
        <div class="empty-state">
          <p>ğŸ“ˆ No hay datos de ingresos disponibles</p>
        </div>
      }
    </div>
  </div>
</div>
