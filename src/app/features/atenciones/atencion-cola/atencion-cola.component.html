<div class="main-content">
  <div class="header-section">
    <div class="header-left">
      <h2>ğŸ“‹ Cola de AtenciÃ³n</h2>
      <p class="subtitle">Gestiona las atenciones en tiempo real</p>
    </div>
    <div class="header-right">
      <div class="last-updated">
        <span class="update-icon">ğŸ”„</span>
        <span>Actualizado: {{ lastUpdated | date:'shortTime' }}</span>
      </div>
      <a routerLink="/atenciones/nueva" class="btn btn-primary">
        â• Nueva AtenciÃ³n
      </a>
    </div>
  </div>

  <!-- Kanban Board -->
  <div class="kanban-board">
    <!-- Columna: En Espera -->
    <div class="kanban-column">
      <div class="column-header waiting">
        <div class="column-title">
          <span class="column-icon">â³</span>
          <span>En Espera</span>
        </div>
        <span class="column-count">{{ getAtencionesByEstado('en_espera').length }}</span>
      </div>
      <div class="column-content">
        @for (atencion of getAtencionesByEstado('en_espera'); track atencion.idAtencion) {
          <div class="atencion-card waiting-card" [routerLink]="['/atenciones', atencion.idAtencion]">
            <div class="card-header-row">
              <span class="turno-badge">Turno #{{ atencion.turnoNum || atencion.idAtencion }}</span>
              <span class="priority-badge" [class.high]="atencion.prioridad === 1">
                P{{ atencion.prioridad || 2 }}
              </span>
            </div>

            <div class="pet-info">
              <div class="pet-avatar">
                {{ getPetInitial(atencion.mascota?.nombre || 'M') }}
              </div>
              <div class="pet-details">
                <h4>{{ atencion.mascota?.nombre || 'Sin nombre' }}</h4>
                <p>{{ atencion.mascota?.raza || 'Raza no especificada' }}</p>
              </div>
            </div>

            <div class="client-row">
              <span class="client-icon">ğŸ‘¤</span>
              <span>{{ atencion.cliente?.nombre || 'Cliente' }} {{ atencion.cliente?.apellido || '' }}</span>
            </div>

            <div class="groomer-row">
              <span class="groomer-icon">ğŸ‘¨â€ğŸ’¼</span>
              <span>{{ atencion.groomer?.nombre || 'Sin asignar' }}</span>
            </div>

            <div class="time-row">
              <span class="time-icon">ğŸ•’</span>
              <span>{{ atencion.tiempoEstimadoInicio | date:'shortTime' }}</span>
            </div>

            <div class="card-actions">
              <button class="btn-action btn-start" (click)="iniciarServicio($event, atencion.idAtencion!)" title="Iniciar">
                â–¶ï¸ Iniciar
              </button>
            </div>
          </div>
        } @empty {
          <div class="empty-column">
            <div class="empty-icon">â±ï¸</div>
            <p>No hay atenciones en espera</p>
          </div>
        }
      </div>
    </div>

    <!-- Columna: En Servicio -->
    <div class="kanban-column">
      <div class="column-header in-service">
        <div class="column-title">
          <span class="column-icon">âœ‚ï¸</span>
          <span>En Servicio</span>
        </div>
        <span class="column-count">{{ getAtencionesByEstado('en_servicio').length }}</span>
      </div>
      <div class="column-content">
        @for (atencion of getAtencionesByEstado('en_servicio'); track atencion.idAtencion) {
          <div class="atencion-card service-card" [routerLink]="['/atenciones', atencion.idAtencion]">
            <div class="card-header-row">
              <span class="turno-badge">Turno #{{ atencion.turnoNum || atencion.idAtencion }}</span>
              <span class="timer-badge">
                â±ï¸ {{ calculateDuration(atencion.tiempoRealInicio!) }}
              </span>
            </div>

            <div class="pet-info">
              <div class="pet-avatar active">
                {{ getPetInitial(atencion.mascota?.nombre || 'M') }}
              </div>
              <div class="pet-details">
                <h4>{{ atencion.mascota?.nombre || 'Sin nombre' }}</h4>
                <p>{{ atencion.mascota?.raza || 'Raza no especificada' }}</p>
              </div>
            </div>

            <div class="client-row">
              <span class="client-icon">ğŸ‘¤</span>
              <span>{{ atencion.cliente?.nombre || 'Cliente' }} {{ atencion.cliente?.apellido || '' }}</span>
            </div>

            <div class="groomer-row">
              <span class="groomer-icon">ğŸ‘¨â€ğŸ’¼</span>
              <span>{{ atencion.groomer?.nombre || 'Sin asignar' }}</span>
            </div>

            <div class="progress-bar">
              <div class="progress-fill"></div>
            </div>

            <div class="card-actions">
              <button class="btn-action btn-continue" (click)="$event.stopPropagation(); continuarAtencion(atencion.idAtencion!)" title="Continuar">
                âœï¸ Atender
              </button>
            </div>
          </div>
        } @empty {
          <div class="empty-column">
            <div class="empty-icon">âœ‚ï¸</div>
            <p>No hay servicios en curso</p>
          </div>
        }
      </div>
    </div>

    <!-- Columna: Terminado -->
    <div class="kanban-column">
      <div class="column-header completed">
        <div class="column-title">
          <span class="column-icon">âœ…</span>
          <span>Terminado</span>
        </div>
        <span class="column-count">{{ getAtencionesByEstado('terminado').length }}</span>
      </div>
      <div class="column-content">
        @for (atencion of getAtencionesByEstado('terminado'); track atencion.idAtencion) {
          <div class="atencion-card completed-card" [routerLink]="['/atenciones', atencion.idAtencion]">
            <div class="card-header-row">
              <span class="turno-badge">Turno #{{ atencion.turnoNum || atencion.idAtencion }}</span>
              <span class="done-badge">âœ“</span>
            </div>

            <div class="pet-info">
              <div class="pet-avatar completed">
                {{ getPetInitial(atencion.mascota?.nombre || 'M') }}
              </div>
              <div class="pet-details">
                <h4>{{ atencion.mascota?.nombre || 'Sin nombre' }}</h4>
                <p>{{ atencion.mascota?.raza || 'Raza no especificada' }}</p>
              </div>
            </div>

            <div class="client-row">
              <span class="client-icon">ğŸ‘¤</span>
              <span>{{ atencion.cliente?.nombre || 'Cliente' }} {{ atencion.cliente?.apellido || '' }}</span>
            </div>

            <div class="groomer-row">
              <span class="groomer-icon">ğŸ‘¨â€ğŸ’¼</span>
              <span>{{ atencion.groomer?.nombre || 'Sin asignar' }}</span>
            </div>

            <div class="time-row completed-time">
              <span class="time-icon">âœ“</span>
              <span>{{ calculateDuration(atencion.tiempoRealInicio!, atencion.tiempoRealFin!) }}</span>
            </div>

            <div class="card-actions">
              <button class="btn-action btn-invoice" (click)="$event.stopPropagation(); generarFactura(atencion.idAtencion!)" title="Generar Factura">
                ğŸ’° Factura
              </button>
            </div>
          </div>
        } @empty {
          <div class="empty-column">
            <div class="empty-icon">ğŸ“¦</div>
            <p>No hay atenciones terminadas</p>
          </div>
        }
      </div>
    </div>
  </div>
</div>
